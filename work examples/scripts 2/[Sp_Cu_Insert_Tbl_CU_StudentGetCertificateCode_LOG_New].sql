USE [SAODB]
GO
/****** Object:  StoredProcedure [dbo].[Sp_Cu_Insert_Tbl_CU_StudentGetCertificateCode_LOG_New]    Script Date: 12/11/2024 3:26:41 PM ******/
SET ANSI_NULLS ON
GO
SET QUOTED_IDENTIFIER ON
GO
ALTER procedure [dbo].[Sp_Cu_Insert_Tbl_CU_StudentGetCertificateCode_LOG_New]
@WFID bigint,
@StatusID bigint,
@NewPortal bit
as
begin
Declare @PK as bigint
set @PK=(
                            SELECT MAX(PKFormID)
                            FROM Task.TblFormInstance
                            WHERE FormID = 31557
                                  AND WorkflowInstanceId = @WFID
                        )

    DECLARE @RegDate AS NVARCHAR(10),
            @RegTime AS NVARCHAR(5),
            @RegDateWF AS NVARCHAR(10),
            @RegTimeWF AS NVARCHAR(5),
            @PortalEntryID AS BIGINT,
            @PortalUserID AS BIGINT,
            @IsEdited AS BIT,
            @IsCancel AS BIT,
            @FirstName AS NVARCHAR(50),
			@FollowUpCode AS NVARCHAR(50),
            @LastName AS NVARCHAR(50),
            @SSNo AS NVARCHAR(20),
            @NationalCode AS NVARCHAR(10),
            @FatherName AS NVARCHAR(100),
            @BirthDate AS NVARCHAR(10),
            @GenderID AS INT,
            @PlaceShenasnameh AS NVARCHAR(100),
            @NationalityID AS INT,
            @ProvinceID AS INT,
            @CityID AS INT,
            @Address AS NVARCHAR(2000),
            @reqUniTypeIDGetCC INT,
            @reqUniIDGetCC INT,
            @reqGradeIDGetCC INT,
            @reqFiledAndOrientationGetCC bigint,
			@reqOrientationIDGetCC INT,
            @reqCourseTypeGetCC INT,
            @reqEducationalMethodGetCC INT,
            @reqEducationStatusGetCC INT,
            @reqCodeSehatGetCC NVARCHAR(50),
            @reqTypeEducationDocGetCC INT,
            @reqTypeAdmissionGetCC INT,
            @reqEducationStartDateGetCC NVARCHAR(10),
            @reqEducationEndDateGetCC NVARCHAR(10),
            @reqCountTermGetCC INT,
            @reqAvrageGetCC nvarchar(10),
            @reqCertificateReceivedGetCC NVARCHAR(1000),
            @reqProposalDateGetCC NVARCHAR(10),
            @reqDefenseDateGetCC NVARCHAR(10),
			@reqCodeRahgiriGetCC NVARCHAR(50),
            @reqArticleTitleGetCC NVARCHAR(100),
            @reqArticleDateGetCC NVARCHAR(10),
            @reqPublicationDateGetCC NVARCHAR(100),
            @reqDOIGetCC NVARCHAR(100),
            @reqLanguageTestDateGetCC NVARCHAR(10),
            @reqUniLanguageTestGetCC NVARCHAR(100),
            @reqAgrageLanguageTestGetCC NVARCHAR(10),
            @ThesisRegistrationGetCC NVARCHAR(100),
            @ThesisPercentageGetCC NVARCHAR(100),
			@DiplomaConfirmationCode bigint,
			@PublicationTitle bigint,
			@GUID nvarchar(100),
			@ChckSecondFieldOfStudy bit,
			@ApplierUserID bigint


    select  @RegDate=col_4968912921487307791,
            @RegTime=col_5555746592445714437,
            @RegDateWF=col_4968912921487307791,
            @RegTimeWF=col_5555746592445714437,
            --@PortalEntryID,
            @PortalUserID=col_5412531398856459271,
            --@IsEdited,
            --@IsCancel,
            @FirstName=col_5342391661964839068,
			@FollowUpCode=@WFID,
            @LastName=col_4654952266962121618,
            @SSNo=col_5726815762359960196,
            @NationalCode =col_4734470423217374397,
            @FatherName=col_5224242156645746902,
            @BirthDate=col_5205102957065814985,
            @GenderID=col_5586840646321793307,
            @PlaceShenasnameh=col_5468352929900442317,
            @NationalityID=col_5345037364810259573,
            @ProvinceID=col_5338025846230761676,
            @CityID=col_5601972249688335632,
            --@Address,
            @reqUniTypeIDGetCC=col_4974638551233729816,
            @reqUniIDGetCC=col_5142745060495369622,
            @reqGradeIDGetCC=col_4917067397180588735,
			---checksecondlable
            @reqFiledAndOrientationGetCC=col_5643547746973002027,
			--@reqOrientationIDGetCC INT,
            @reqCourseTypeGetCC=col_4870093364387865696,
            @reqEducationalMethodGetCC=col_5758484480041763043,
     
       --@reqEducationStatusGetCC=,
            --@reqCodeSehatGetCC,
            --@reqTypeEducationDocGetCC INT,--????????????????
            @reqTypeAdmissionGetCC=col_4978704305232428433,--ReceptionTypeID نوع پذیرش 
            @reqEducationStartDateGetCC=col_5186808448083751206,
            @reqEducationEndDateGetCC=col_5469543385160353185,
            --@reqCountTermGetCC,
            @reqAvrageGetCC=col_4771332568560840569,
            @reqCertificateReceivedGetCC=col_5691934503335515439,
            @reqProposalDateGetCC=col_4938790910814184430,
            @reqDefenseDateGetCC=col_4842655738932492373,
			@reqCodeRahgiriGetCC=col_5509776657513588778,
            @reqArticleTitleGetCC=col_5581590352657073828,
            @reqArticleDateGetCC=col_4799563231252600505,
            --@reqPublicationDateGetCC=--????????????????,
            @reqDOIGetCC=col_5043963972683885644,
            @reqLanguageTestDateGetCC=col_5056421174122750557,
            @reqUniLanguageTestGetCC=col_4848334118159103872,
            @reqAgrageLanguageTestGetCC=col_5088332825863999665,
            @ThesisRegistrationGetCC=col_5343661206958534123,
            @ThesisPercentageGetCC=col_4990472185996140725,
			@DiplomaConfirmationCode=col_4648214887473289335,
			@PublicationTitle=col_4980122478765994241,
			@GUID=col_5457383593707442961,
			@ChckSecondFieldOfStudy=col_4972634513127442249
		   FROM Tbl_frm31557
           WHERE frm31557Id =@PK

set @ApplierUserID=(select top 1 ExternalUserId from users.TblMemebrShips where UserId=@PortalUserID)

 
    
        ----------------------------****************-----------------
        INSERT INTO Tbl_Cu_StudentGetCertificateCode_LOG
        (
            WFID,
            RegDate,
            RegTime,
            RegDateWF,
            RegTimeWF,
            PortalUserID,
            StatusID,
            FirstName,
            LastName,
            SSNo,
            NationalCode,
            FatherName,
            BirthDate,
            GenderID,
            PlaceShenasnameh,
            NationalityID,
            ProvinceID,
            CityID,
            reqUniTypeIDGetCC,
            reqUniIDGetCC,
            reqGradeIDGetCC,
            reqFiledAndOrientationGetCC,
            reqCourseTypeGetCC,
            reqEducationalMethodGetCC,
            reqTypeEducationDocGetCC,
            reqTypeAdmissionGetCC,
            reqEducationStartDateGetCC,
            reqEducationEndDateGetCC,
            reqAvrageGetCC,
            reqCertificateReceivedGetCC,
            reqProposalDateGetCC,
            reqDefenseDateGetCC,
            reqArticleTitleGetCC,
            reqArticleDateGetCC,
            --reqPublicationDateGetCC,
            reqDOIGetCC,
            reqLanguageTestDateGetCC,
            reqUniLanguageTestGetCC,
            reqAgrageLanguageTestGetCC,
            ThesisRegistrationGetCC,
            ThesisPercentageGetCC,
		    FollowUpCode,
		    reqCodeRahgiriGetCC,
			DiplomaConfirmationCode,
			PublicationTitle,
			frm31557Id,
			GUID,
			ChckSecondFieldOfStudy,
			NewPortal
        )
        SELECT @WFID,
               @RegDate,
               @RegTime,
               @RegDateWF,
               @RegTimeWF,
               @ApplierUserID,
               @StatusID,
               @FirstName,
               @LastName,
               @SSNo,
               @NationalCode,
               @FatherName,
               @BirthDate,
               @GenderID,
               @PlaceShenasnameh,
               @NationalityID,
               @ProvinceID,
               @CityID,
               @reqUniTypeIDGetCC,
               @reqUniIDGetCC,
               @reqGradeIDGetCC,
               @reqFiledAndOrientationGetCC,
               @reqCourseTypeGetCC,
               @reqEducationalMethodGetCC,
               @reqTypeEducationDocGetCC,
               @reqTypeAdmissionGetCC,
               @reqEducationStartDateGetCC,
               @reqEducationEndDateGetCC,
               @reqAvrageGetCC,
               @reqCertificateReceivedGetCC,
               @reqProposalDateGetCC,
               @reqDefenseDateGetCC,
               @reqArticleTitleGetCC,
               @reqArticleDateGetCC,
               --@reqPublicationDateGetCC,
               @reqDOIGetCC,
               @reqLanguageTestDateGetCC,
               @reqUniLanguageTestGetCC,
               @reqAgrageLanguageTestGetCC,
               @ThesisRegistrationGetCC,
               @ThesisPercentageGetCC,
			   @FollowUpCode,
			   @reqCodeRahgiriGetCC,
			   @DiplomaConfirmationCode,
			   @PublicationTitle,
			   @PK,
			   @GUID,
			   @ChckSecondFieldOfStudy,
			   @NewPortal

	SELECT top 1 reqUniTypeIDGetCC as UniTypeID
        FROM Tbl_Cu_StudentGetCertificateCode_LOG
        WHERE WFID = @WFID
		order by StudentGetCertificateCodeID desc
end
